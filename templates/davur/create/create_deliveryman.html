{% extends 'davur/elements/base_modal.html' %}
{% load widget_tweaks %}

{% block modal_title_block %}
    <h5 class="modal-title">Añadiendo repartidor</h5>
{% endblock modal_title_block %}

{% block form_block %}
<form id="deliveryman-form" method="POST" action="{% url 'ors:create-deliveryman'%}">
    <div class="modal-body">
        <div class="basic-form">

            {% csrf_token %}

            {% include 'davur/elements/base-deliveryman-form.html' %}

            <div class="modal-footer">
                <button type="button" class="btn btn-danger light" data-bs-dismiss="modal">Cerrar</button>
                <button type="submit" class="btn btn-primary">Añadir</button>
            </div>
        </div>
    </div>
</form>
{% endblock form_block %}

{% block additionalAjax %}
     <script>
        $(document).ready(function() {
      $('#deliveryman-form').submit(function(event) {
        event.preventDefault(); // Prevent the default form submission

        var form = $(this);
        var formData = form.serialize(); // Serialize the form data

        // Send the AJAX request to check if cedula is valid
        $.ajax({
          url: form.attr('action'),
          type: form.attr('method'),
          data: formData,
          success: function(response) {
            // Check if the cedula exists
            if (response.exists) {
              // Show an error message in the modal
              $('#error-message').text(response.errors);
            } else {
              // Submit the form if the cedula doesn't exist
              window.location.href = response.redirect_to;
            }
          },
          error: function(xhr, status, error) {
            // Handle error if the AJAX request fails
            console.error(xhr.responseText);
          }
        });
      });
    });
    </script>

{% endblock additionalAjax %}


